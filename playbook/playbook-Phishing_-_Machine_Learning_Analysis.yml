contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.1.0
    itemVersion: 3.5.30
    packID: Phishing
    packName: Phishing
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Runs various machine-learning based checks on phishing emails and URLs,
  in an attempt to predict whether they are phishing or benign.
id: Phishing - Machine Learning Analysis
inputs:
- description: The list of URLs that were extracted from the file. This output is
    a duplicate of the URL.Data output and it enables parent playbooks to identify
    the URLs generated by this playbook.
  key: ExtractedURLsFromFiles
  playbookInputQuery: null
  required: false
  value: {}
- description: Optional - the name of a pre-trained phishing model to predict phishing
    type using machine learning.
  key: PhishingModelName
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    The number of URLs to extract from the email HTML and analyze in the "DBotPredictURLPhishing" automation.
    This automation runs several checks to determine the score of the URLs found in the email, sets a verdict for URLs found as "Suspicious" or "Malicious", and adds these URLs as indicators. Based on the verdict, the incident severity is set (Medium for "Suspicious" and High for "Malicious").
    Note:
    - You need to install the "Phishing URL" pack to use this automation.
    - False/True positives are possible.
    - This automation may take a few minutes to run.
    - To increase result accuracy, it is recommended to install and enable the "Whois" pack (optional).
  key: DBotPredictURLPhishingURLsNumber
  playbookInputQuery: null
  required: false
  value: {}
- description: The email text of the phishing email if it exists.
  key: EmailText
  playbookInputQuery: null
  required: false
  value: {}
- description: The email HTML body of the phishing email if it exists.
  key: EmailHTML
  playbookInputQuery: null
  required: false
  value: {}
- description: The subject of the phishing email if it exists.
  key: EmailSubject
  playbookInputQuery: null
  required: false
  value: {}
name: Phishing - Machine Learning Analysis
outputs: []
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
      - "5"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 2900bd34-b64f-4646-871e-4679cb5a5296
      iscommand: false
      name: ""
      version: -1
    taskid: 2900bd34-b64f-4646-871e-4679cb5a5296
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 460,
          "y": 50
        }
      }
  "1":
    continueonerror: true
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      emailBody:
        complex:
          root: inputs.EmailText
          transformers:
          - operator: uniq
      emailBodyHTML:
        complex:
          root: inputs.EmailHTML
          transformers:
          - operator: uniq
      emailSubject:
        complex:
          root: inputs.EmailSubject
          transformers:
          - operator: uniq
      modelName:
        complex:
          root: inputs.PhishingModelName
      returnError:
        simple: "false"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Predicts the specific phishing mail type using a pre-trained machine
        learning model, and highlights the most important words used in the classification
        decision.
      id: 5e4e4a8f-7beb-4747-83ad-e5cb91005f28
      iscommand: false
      name: Predict phishing type using custom trained phishing model
      script: DBotPredictPhishingWords
      type: regular
      version: -1
    taskid: 5e4e4a8f-7beb-4747-83ad-e5cb91005f28
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 137.5,
          "y": 540
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      dbotprediction:
        complex:
          accessor: Label
          root: DBotPredictPhishingWords
          transformers:
          - operator: uniq
      dbotpredictionprobability:
        complex:
          accessor: Probability
          root: DBotPredictPhishingWords
          transformers:
          - operator: uniq
      dbottextsuggestionhighlighted:
        complex:
          accessor: TextTokensHighlighted
          root: DBotPredictPhishingWords
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Updates incident fields with the machine learning phishing model
        predictions.
      id: 5345d43a-b025-4330-8e87-98526f3d5741
      iscommand: true
      name: Update incident with predictions
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 5345d43a-b025-4330-8e87-98526f3d5741
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 137.5,
          "y": 935
        }
      }
  "3":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Label
                root: DBotPredictPhishingWords
          operator: isNotEmpty
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Probability
                root: DBotPredictPhishingWords
          operator: isNotEmpty
      - - left:
            iscontext: true
            value:
              complex:
                accessor: TextTokensHighlighted
                root: DBotPredictPhishingWords
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether the model predicted the phishing type.
      id: 303ac6fb-f6e4-420f-8c61-4ce748ff84de
      iscommand: false
      name: Did the model predict the phishing type?
      type: condition
      version: -1
    taskid: 303ac6fb-f6e4-420f-8c61-4ce748ff84de
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 137.5,
          "y": 725
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    reputationcalc: 2
    scriptarguments:
      emailBody:
        complex:
          root: inputs.EmailText
      emailHTML:
        complex:
          accessor: emailhtml
          root: incident
      maxNumberOfURL:
        complex:
          root: inputs.DBotPredictURLPhishingURLsNumber
      urls:
        complex:
          root: inputs.ExtractedURLsFromFiles
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Predicts phishing URLs using a pre-trained model.
      id: cdddceeb-fc75-4a43-8cce-e0d6eb1fde3b
      iscommand: false
      name: Predict Phishing URLs
      script: DBotPredictURLPhishing
      type: regular
      version: -1
    taskid: cdddceeb-fc75-4a43-8cce-e0d6eb1fde3b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 780,
          "y": 530
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 72983272-0f84-40fc-847a-9eb6276f724a
      iscommand: false
      name: Predict Phishing Type
      type: title
      version: -1
    taskid: 72983272-0f84-40fc-847a-9eb6276f724a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 137.5,
          "y": 205
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 31000bcf-f2bf-4cc0-8764-f40671c8aa6f
      iscommand: false
      name: Predict Phishing URLs
      type: title
      version: -1
    taskid: 31000bcf-f2bf-4cc0-8764-f40671c8aa6f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 780,
          "y": 205
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      brandname:
        simple: Rasterize
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Returns 'yes' if integration brand is available. Otherwise returns
        'no'.
      id: fed90362-cf65-406c-8c9a-0c7f95b96e0e
      iscommand: false
      name: Is the Rasterize integration enabled?
      script: IsIntegrationAvailable
      type: condition
      version: -1
    taskid: fed90362-cf65-406c-8c9a-0c7f95b96e0e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 780,
          "y": 340
        }
      }
  "8":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.PhishingModelName
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether there is a phishing model name in the PhishingModelName
        playbook input. If no model was specified, the OOTB pre-trained model will
        run.
      id: 87380172-9f96-4da1-8aad-9422659e770c
      iscommand: false
      name: Was a trained phishing model specified?
      type: condition
      version: -1
    taskid: 87380172-9f96-4da1-8aad-9422659e770c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 137.5,
          "y": 340
        }
      }
  "9":
    continueonerror: true
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      emailBody:
        complex:
          root: inputs.EmailText
          transformers:
          - operator: uniq
      emailBodyHTML:
        complex:
          root: inputs.EmailHTML
          transformers:
          - operator: uniq
      emailSubject:
        complex:
          root: inputs.EmailSubject
          transformers:
          - operator: uniq
      returnError:
        simple: "false"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Predict phishing incidents using the out-of-the-box pre-trained
        model.
      id: 948d42a3-3fd5-4592-8da5-3c02768ca950
      iscommand: false
      name: Predict phishing type using pre-trained OOTB phishing model
      script: DBotPredictOutOfTheBoxV2
      type: regular
      version: -1
    taskid: 948d42a3-3fd5-4592-8da5-3c02768ca950
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -290,
          "y": 540
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8ee3c6f5-93b4-4477-8f18-f76a1e55f0eb
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 8ee3c6f5-93b4-4477-8f18-f76a1e55f0eb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1110
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "3_10_#default#": 0.21,
      "7_10_#default#": 0.31,
      "7_4_yes": 0.54
    },
    "paper": {
      "dimensions": {
        "height": 1125,
        "width": 1450,
        "x": -290,
        "y": 50
      }
    }
  }
