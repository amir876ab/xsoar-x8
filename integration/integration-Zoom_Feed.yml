category: Data Enrichment & Threat Intelligence
commonfields:
  id: Zoom Feed
  version: -1
configuration:
- defaultvalue: "true"
  display: Fetch indicators
  name: feed
  required: false
  type: 8
- additionalinfo: Zoom clients for certificate validation
  defaultvalue: crl3.digicert.com,crl4.digicert.com,ocsp.digicert.com,certificates.godaddy.com,crl.godaddy.com,ocsp.godaddy.com,certificates.starfieldtech.com,crl.starfieldtech.com,ocsp.starfieldtech.com
  display: Firewall rules for certificate validation
  name: zoom_clients_certificate_validation
  options:
  - crl3.digicert.com
  - crl4.digicert.com
  - ocsp.digicert.com
  - certificates.godaddy.com
  - crl.godaddy.com
  - ocsp.godaddy.com
  - certificates.starfieldtech.com
  - crl.starfieldtech.com
  - ocsp.starfieldtech.com
  required: false
  type: 16
- additionalinfo: All Zoom Clients. User's web browser
  defaultvalue: '*.zoom.us,*.cloudfront.net'
  display: Firewall rules for Zoom website
  name: zoom_clients_user_browser
  options:
  - '*.zoom.us'
  - '*.cloudfront.net'
  required: false
  type: 16
- additionalinfo: Indicators from this integration instance will be marked with this
    reputation.
  defaultvalue: Good
  display: Indicator Reputation
  name: feedReputation
  options:
  - None
  - Good
  - Suspicious
  - Bad
  required: false
  type: 18
- additionalinfo: Reliability of the source providing the intelligence data
  defaultvalue: A - Completely reliable
  display: Source Reliability
  name: feedReliability
  options:
  - A - Completely reliable
  - B - Usually reliable
  - C - Fairly reliable
  - D - Not usually reliable
  - E - Unreliable
  - F - Reliability cannot be judged
  required: true
  type: 15
- additionalinfo: The Traffic Light Protocol (TLP) designation to apply to indicators
    fetched from the feed
  display: Traffic Light Protocol Color
  name: tlp_color
  options:
  - RED
  - AMBER
  - GREEN
  - WHITE
  required: false
  type: 15
- defaultvalue: suddenDeath
  display: ""
  name: feedExpirationPolicy
  options:
  - never
  - interval
  - indicatorType
  - suddenDeath
  required: false
  type: 17
- defaultvalue: "20160"
  display: ""
  name: feedExpirationInterval
  required: false
  type: 1
- additionalinfo: Setting a more frequent fetch interval may cause errors from the
    vendor.
  defaultvalue: "240"
  display: Feed Fetch Interval
  name: feedFetchInterval
  required: false
  type: 19
- additionalinfo: Supports CSV values.
  display: Tags
  name: feedTags
  required: false
  type: 0
- additionalinfo: When selected, the exclusion list is ignored for indicators from
    this feed. This means that if an indicator from this feed is on the exclusion
    list, the indicator might still be added to the system.
  defaultvalue: "true"
  display: Bypass exclusion list
  name: feedBypassExclusionList
  required: false
  type: 8
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 1.1.13
    packID: FeedZoom
    packName: Zoom Feed
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Use the Zoom Feed integration to get indicators from the feed.
detaileddescription: "## Zoom Endpoints Web Scraper\nhttps://support.zoom.us/hc/en-us/articles/201362683-Network-Firewall-or-Proxy-Server-Settings-for-Zoom\n\nMost
  IT services are moving from on-premise solutions to cloud-based solutions. The public
  IP addresses, domains, and URLs that function as the endpoints for these solutions
  are very often not fixed, and the providers of the service publish their details
  on their websites in a less than ideal format (i.e.: HTML) rather than through a
  proper REST API (i.e.: JSON).\n\nThis fact makes it very difficult for IT and Security
  teams to provide these services with an appropriate level of security and automation.
  Any changes in the HTML schema of the provider website, will break the automation
  and has the potential to cause serious disruption to the users and the business.
  The alternative is to compromise on the security posture of the organization.\n\nOne
  example of these providers is Zoom.\n\nThis pack aims is to address this issue by
  automating the collection of endpoint data in the form of an indicator feed. This
  will facilitate validation of the indicators before using them in enforcement points,
  for example firewalls, proxies, and more.\n\nThis integration fetches the data from
  five files linked in the website above:  \nhttps://assets.zoom.us/docs/ipranges/Zoom.txt\nhttps://assets.zoom.us/docs/ipranges/ZoomMeetings.txt\nhttps://assets.zoom.us/docs/ipranges/ZoomCRC.txt\nhttps://assets.zoom.us/docs/ipranges/ZoomPhone.txt\nhttps://assets.zoom.us/docs/ipranges/ZoomCDN.txt\n\n\n---\n[View
  Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/zoom-feed)"
display: Zoom Feed
image: data:image/png;base64,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
name: Zoom Feed
script:
  commands:
  - arguments:
    - defaultValue: "10"
      description: The maximum number of results to return. The default value is 10.
      name: limit
    description: Gets indicators from the feed.
    name: zoom-get-indicators
  dockerimage: demisto/btfl-soup:1.0.1.45563
  feed: true
  runonce: false
  script: |
    register_module_line('Zoom Feed', 'start', __line__())
    ### pack version: 1.1.13


    from typing import Dict, List, Callable, Optional, Union

    import urllib3


    # disable insecure warnings
    urllib3.disable_warnings()

    INTEGRATION_NAME = "Zoom Feed"
    ZOOM_DOCS_IP_RANGES_URL = "https://assets.zoom.us/docs/ipranges"


    class Client(BaseClient):
        """
        Client to use in the Zoom Feed integration. Overrides BaseClient.
        """

        def __init__(self, base_url: str, verify: bool = False, proxy: bool = False):
            """
            Implements class for Zoom feeds.
            :param url: the Zoom endpoint URL
            :verify: boolean, if *false* feed HTTPS server certificate is verified. Default: *false*
            :param proxy: boolean, if *false* feed HTTPS server certificate will not use proxies. Default: *false*
            """
            super().__init__(base_url, verify=verify, proxy=proxy)

        def get_indicators(self) -> Set:
            """
            Uses 5 text files which contains zoom endpoints. This files are linked from:
            https://support.zoom.us/hc/en-us/articles/201362683-Network-Firewall-or-Proxy-Server-Settings-for-Zoom
            and contains all the endpoints listed on the zoom firewall rules tables, accept the domains and ipv6 addresses.
            Using the text files instead of parsing the http page ×Ÿs due to blockage of the zoom support site.
            """
            params = demisto.params()
            list_ips_txt_files = ['Zoom.txt',
                                  'ZoomMeetings.txt',
                                  'ZoomCRC.txt',
                                  'ZoomPhone.txt',
                                  'ZoomCDN.txt']

            indicators = set(argToList(params.get('zoom_clients_certificate_validation', [])))
            indicators.update(set(argToList(params.get('zoom_clients_user_browser', []))))

            for url in list_ips_txt_files:
                res = self._http_request(method='GET', url_suffix=url, resp_type='text')
                for ip in res.split('\n'):
                    indicators.add(ip)
            return indicators

        def build_iterator(self) -> List:
            """Retrieves all entries from the feed.
            Returns:
                A list of objects, containing the indicators.
            """
            result = []

            try:
                indicators = list(self.get_indicators())

                for indicator in indicators:
                    if auto_detect_indicator_type(indicator):
                        result.append(
                            {"value": indicator, "type": auto_detect_indicator_type(indicator), "FeedURL": self._base_url}
                        )

            except requests.exceptions.SSLError as err:
                demisto.debug(str(err))
                raise Exception(
                    f"Connection error in the API call to {INTEGRATION_NAME}.\n"
                    f"Check your not secure parameter.\n\n{err}"
                )
            except requests.ConnectionError as err:
                demisto.debug(str(err))
                raise Exception(
                    f"Connection error in the API call to {INTEGRATION_NAME}.\n"
                    f"Check your Server URL parameter.\n\n{err}"
                )
            except requests.exceptions.HTTPError as err:
                demisto.debug(str(err))
                raise Exception(f"Connection error in the API call to {INTEGRATION_NAME}.\n")
            except ValueError as err:
                demisto.debug(str(err))
                raise ValueError(f"Could not parse returned data to Json. \n\nError massage: {err}")

            return result


    def test_module(client: Client, *_) -> str:
        """Builds the iterator to check that the feed is accessible.
        Args:
            client: Client object.
        Returns:
            Outputs.
        """
        client.build_iterator()
        return "ok"


    def fetch_indicators(client: Client, feed_tags: List = [], tlp_color: Optional[str] = None,
                         limit: int = -1) -> List[Dict]:
        """Retrieves indicators from the feed
        Args:
            client (Client): Client object with request
            feed_tags (list): tags to assign fetched indicators
            limit (int): limit the results
            tlp_color (str): Traffic Light Protocol color
        Returns:
            Indicators.
        """
        iterator = client.build_iterator()
        indicators = []
        if limit > 0:
            iterator = iterator[:limit]
        for item in iterator:
            value = item.get("value")
            type_ = item.get("type", FeedIndicatorType.Domain)
            raw_data = {
                "value": value,
                "type": type_,
            }
            for key, val in item.items():
                raw_data.update({key: val})
            indicator_obj = {
                "value": value,
                "type": type_,
                "service": "Zoom Feed",
                "rawJSON": raw_data,
                'fields': {}
            }
            if feed_tags:
                indicator_obj["fields"]['tags'] = feed_tags
            if tlp_color:
                indicator_obj["fields"]['trafficlightprotocol'] = tlp_color

            indicators.append(indicator_obj)
        return indicators


    def get_indicators_command(
            client: Client, params: Dict[str, str], args: Dict[str, str]
    ) -> CommandResults:
        """Wrapper for retrieving indicators from the feed to the war-room.
        Args:
            client: Client object with request
            params: demisto.params()
            args: demisto.args()
        Returns:
            Outputs.
        """
        feed_tags = argToList(params.get("feedTags", ""))
        tlp_color = params.get('tlp_color')
        limit = arg_to_number(args.get('limit')) or 10
        indicators = fetch_indicators(client, feed_tags, tlp_color, limit)

        if indicators:
            human_readable = tableToMarkdown(
                "Indicators from Zoom Feed:", indicators, headers=["value", "type"], removeNull=True
            )
        else:
            human_readable = "No indicators from Zoom Feed were fetched."

        return CommandResults(readable_output=human_readable,
                              raw_response=indicators)


    def fetch_indicators_command(client: Client, params: Dict[str, str]) -> List[Dict]:
        """Wrapper for fetching indicators from the feed to the Indicators tab.
        Args:
            client: Client object with request
            params: demisto.params()
        Returns:
            Indicators.
        """
        feed_tags = argToList(params.get("feedTags", ""))
        tlp_color = params.get('tlp_color')
        indicators = fetch_indicators(client, feed_tags, tlp_color)
        return indicators


    def main():
        """
        PARSE AND VALIDATE INTEGRATION PARAMS
        """
        params = demisto.params()
        insecure = not params.get("insecure", False)
        proxy = params.get("proxy", False)

        command = demisto.command()
        demisto.info(f"Command being called is {command}")

        try:
            client = Client(base_url=ZOOM_DOCS_IP_RANGES_URL, verify=insecure, proxy=proxy)

            commands: Dict[
                str, Callable[[Client, Dict[str, str], Dict[str, str]], Union[str, CommandResults]]
            ] = {"test-module": test_module, "zoom-get-indicators": get_indicators_command}
            if command in commands:
                return_results(commands[command](client, demisto.params(), demisto.args()))

            elif command == "fetch-indicators":
                indicators = fetch_indicators_command(client, demisto.params())
                for iter_ in batch(indicators, batch_size=2000):
                    demisto.createIndicators(iter_)

            else:
                raise NotImplementedError(f"Command {command} is not implemented.")

        except Exception as err:
            err_msg = f"Error in {INTEGRATION_NAME} Integration. [{err}]"
            return_error(err_msg)


    if __name__ in ["__main__", "builtin", "builtins"]:
        main()

    register_module_line('Zoom Feed', 'end', __line__())
  subtype: python3
  type: python
system: true
